{
  "instance_id": "django__django-11564",
  "model_name_or_path": "loki-mode-sonnet",
  "model_patch": "--- a/django/core/files/storage.py\n+++ b/django/core/files/storage.py\n@@ -8,6 +8,7 @@ from django.conf import settings\n from django.core.exceptions import SuspiciousFileOperation\n from django.core.files import File, locks\n from django.core.signals import setting_changed\n+from django.urls import get_script_prefix\n from django.utils import timezone\n from django.utils._os import safe_join\n from django.utils.crypto import get_random_string\n@@ -116,7 +117,14 @@ class FileSystemStorage(Storage):\n             url = filepath_to_uri(name)\n         if url is not None:\n             url = url.lstrip('/')\n-        return urljoin(self.base_url, url)\n+        url = urljoin(self.base_url, url)\n+        # Add SCRIPT_NAME prefix to relative URLs (those starting with /)\n+        # but not absolute URLs (those with a scheme like http://)\n+        if url.startswith('/') and not url.startswith('//'):\n+            script_prefix = get_script_prefix()\n+            if script_prefix != '/' and not url.startswith(script_prefix):\n+                url = script_prefix.rstrip('/') + url\n+        return url\n \n     def _datetime_from_timestamp(self, ts):\n         \"\"\"\n--- a/django/templatetags/static.py\n+++ b/django/templatetags/static.py\n@@ -1,6 +1,7 @@\n from django import template\n from django.apps import apps\n from django.utils.encoding import iri_to_uri\n+from django.urls import get_script_prefix\n \n register = template.Library()\n \n@@ -68,7 +69,13 @@ class StaticNode(template.Node):\n     def url(self, context):\n         path = self.path.resolve(context)\n-        return self.handle_simple(path)\n+        url = self.handle_simple(path)\n+        # Add SCRIPT_NAME prefix to relative URLs\n+        if url.startswith('/') and not url.startswith('//'):\n+            script_prefix = get_script_prefix()\n+            if script_prefix != '/' and not url.startswith(script_prefix):\n+                url = script_prefix.rstrip('/') + url\n+        return url\n \n     def render(self, context):\n         url = self.url(context)",
  "attempts": 1,
  "success": true,
  "error": null,
  "timestamp": "2026-01-05T18:12:13.096201"
}