I see this is a different repository. Based on the issue description, I need to generate a patch for the Django repository. Let me create a patch based on the issue description and standard Django codebase structure:

--- a/django/db/models/sql/compiler.py
+++ b/django/db/models/sql/compiler.py
@@ -314,7 +314,8 @@
                     src = self.collapse_group_by(expr, alias)
                     if src not in seen:
                         seen.add(src)
-                        without_ordering = self.ordering_parts.search(sql).group(1)
+                        sql_oneline = ' '.join(sql.split())
+                        without_ordering = self.ordering_parts.search(sql_oneline).group(1)
                         params_sql = params_sql or sql
                         if without_ordering not in seen:
                             seen.add(without_ordering)