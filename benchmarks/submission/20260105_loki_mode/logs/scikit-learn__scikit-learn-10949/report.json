{
  "instance_id": "scikit-learn__scikit-learn-10949",
  "model_name_or_path": "loki-mode-sonnet",
  "model_patch": "Based on the task description, I understand I need to create a patch for the scikit-learn repository to fix the `warn_on_dtype` issue with pandas DataFrames. Since this is a patch generation task for a different repository (scikit-learn), I'll generate the patch based on the architect's analysis and my knowledge of scikit-learn's validation module.\n\nThe issue is that when a DataFrame is converted to an array, the original dtype is lost before the warning check. The fix needs to capture the original dtype before conversion.\n\n--- a/sklearn/utils/validation.py\n+++ b/sklearn/utils/validation.py\n@@ -400,6 +400,7 @@ def check_array(array, accept_sparse=False, dtype=\"numeric\", order=None,\n         raise ValueError(\"Found array with %d sample(s) (shape=%s) while a\"\n                          \" minimum of %d is required.\" % (n_samples, array.shape, ensure_min_samples))\n \n+    dtype_orig = None\n     if warn_on_dtype and dtype is not None and array.dtype in dtype:\n         # Don't warn if array.dtype matches the requested dtype, or if\n         # array.dtype matches any of the requested dtypes (in case dtype is a tuple of dtypes).\n@@ -407,11 +408,19 @@ def check_array(array, accept_sparse=False, dtype=\"numeric\", order=None,\n \n     # make sure we actually converted to numeric:\n     if dtype_numeric and array.dtype.kind == \"O\":\n-        array = array.astype(np.float64)\n+        dtype_orig = array.dtype\n+        try:\n+            array = array.astype(np.float64)\n+        except (ValueError, TypeError):\n+            raise ValueError(\"Unable to convert array of type %s to float64\" % array.dtype)\n     if not allow_nd and array.ndim >= 3:\n         raise ValueError(\"Found array with dim %d. %s expected <= 2.\"\n                          % (array.ndim, estimator_name))\n \n+    if warn_on_dtype and dtype_orig is not None and dtype_orig != array.dtype:\n+        warnings.warn(\"Data with input dtype %s was converted to %s.\"\n+                      % (dtype_orig, array.dtype),\n+                      DataConversionWarning)\n+\n     if force_all_finite:\n         _assert_all_finite(array,\n                            allow_nan=force_all_finite == 'allow-nan')",
  "attempts": 1,
  "success": true,
  "error": null,
  "timestamp": "2026-01-05T20:29:01.029135"
}