{
  "instance_id": "django__django-15252",
  "model_name_or_path": "loki-mode-sonnet",
  "model_patch": "Perfect! I can see the expected patch format. Now let me generate the correct patch for the django__django-15252 issue:\n\n--- a/django/db/migrations/recorder.py\n+++ b/django/db/migrations/recorder.py\n@@ -1,5 +1,6 @@\n from django.apps.registry import Apps\n from django.db import models\n+from django.db import router\n from django.db.utils import DatabaseError\n from django.utils.functional import classproperty\n from django.utils.timezone import now\n@@ -56,18 +57,29 @@ class MigrationRecorder:\n         return self._migration_class\n \n     def ensure_schema(self):\n-        \"\"\"Ensure the table exists and has the correct schema.\"\"\"\n+        \"\"\"\n+        Ensure the table exists and has the correct schema.\n+        If the router disallows migration for this model, skip creating the table.\n+        \"\"\"\n+        if not router.allow_migrate(self.connection.alias, self.Migration):\n+            return\n         # If the table's there, that's fine - we've never changed its schema\n         # in the codebase.\n         if self.has_table():\n             return\n-        # Make the table\n         try:\n             with self.connection.schema_editor() as editor:\n                 editor.create_model(self.Migration)\n         except DatabaseError as exc:\n             raise MigrationSchemaMissing(\"Unable to create the django_migrations table (%s)\" % exc)\n \n+    def _has_routing_permission(self):\n+        \"\"\"Check if router allows migrations on this connection.\"\"\"\n+        return router.allow_migrate(self.connection.alias, self.Migration)\n+\n     def applied_migrations(self):\n         \"\"\"\n         Return a dict mapping (app_name, migration_name) to Migration instances\n@@ -75,6 +87,8 @@ class MigrationRecorder:\n         \"\"\"\n         if self.has_table():\n             return {(migration.app, migration.name): migration for migration in self.migration_qs}\n+        elif not self._has_routing_permission():\n+            return {}\n         else:\n             # If the django_migrations table doesn't exist, then no migrations\n             # are applied.\n@@ -82,6 +96,8 @@ class MigrationRecorder:\n \n     def record_applied(self, app, name):\n         \"\"\"Record that a migration was applied.\"\"\"\n+        if not self._has_routing_permission():\n+            return\n         self.ensure_schema()\n         self.migration_qs.create(app=app, name=name)\n \n@@ -89,5 +105,7 @@ class MigrationRecorder:\n         \"\"\"Record that a migration was unapplied.\"\"\"\n+        if not self._has_routing_permission():\n+            return\n         self.ensure_schema()\n         self.migration_qs.filter(app=app, name=name).delete()",
  "attempts": 1,
  "success": true,
  "error": null,
  "timestamp": "2026-01-05T19:06:30.841897"
}