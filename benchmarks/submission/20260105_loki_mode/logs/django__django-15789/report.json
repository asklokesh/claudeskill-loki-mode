{
  "instance_id": "django__django-15789",
  "model_name_or_path": "loki-mode-sonnet",
  "model_patch": "--- a/django/utils/html.py\n+++ b/django/utils/html.py\n@@ -62,7 +62,7 @@ _json_script_escapes = {\n }\n \n \n-def json_script(value, element_id):\n+def json_script(value, element_id, encoder=None):\n     \"\"\"\n     Escape all the HTML/XML special characters with their unicode escapes, so\n     value is safe to be output anywhere except for inside a tag attribute. Wrap\n@@ -70,7 +70,9 @@ def json_script(value, element_id):\n     \"\"\"\n     from django.core.serializers.json import DjangoJSONEncoder\n-    json_str = json.dumps(value, cls=DjangoJSONEncoder).translate(_json_script_escapes)\n+    if encoder is None:\n+        encoder = DjangoJSONEncoder\n+    json_str = json.dumps(value, cls=encoder).translate(_json_script_escapes)\n     return format_html(\n         '<script id=\"{}\" type=\"application/json\">{}</script>',\n         element_id, mark_safe(json_str)\n--- a/tests/utils_tests/test_html.py\n+++ b/tests/utils_tests/test_html.py\n@@ -1,3 +1,4 @@\n+import json\n from datetime import datetime\n \n from django.test import SimpleTestCase\n@@ -174,6 +175,21 @@ class TestUtilsHtml(SimpleTestCase):\n             )\n         )\n \n+    def test_json_script_custom_encoder(self):\n+        class CustomEncoder(json.JSONEncoder):\n+            def encode(self, o):\n+                if isinstance(o, set):\n+                    return list(o)\n+                return super().encode(o)\n+\n+        self.assertHTMLEqual(\n+            json_script({\"key\": \"value\"}, \"test-id\", encoder=CustomEncoder),\n+            '<script id=\"test-id\" type=\"application/json\">{\"key\": \"value\"}</script>',\n+        )\n+        self.assertHTMLEqual(\n+            json_script({\"key\": {1, 2, 3}}, \"test-id\", encoder=CustomEncoder),\n+            '<script id=\"test-id\" type=\"application/json\">{\"key\": [1, 2, 3]}</script>',\n+        )\n \n class TestEscapeLeadingSlashes(SimpleTestCase):\n     def test_escape(self):",
  "attempts": 1,
  "success": true,
  "error": null,
  "timestamp": "2026-01-05T19:11:52.963359"
}