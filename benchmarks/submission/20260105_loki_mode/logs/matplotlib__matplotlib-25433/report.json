{
  "instance_id": "matplotlib__matplotlib-25433",
  "model_name_or_path": "loki-mode-sonnet",
  "model_patch": "Now I understand. This is a SWE-bench benchmark environment. The user is asking me to act as the ENGINEER AGENT and generate a patch for a matplotlib bug. Based on the architect's analysis, I need to fix the RangeSlider callback issue.\n\nThe core issue is that when `clf()` is called within a RangeSlider's `on_changed` callback during a mouse drag event, the widget gets destroyed while the callback is still executing, which breaks the event handling chain.\n\nThe fix should ensure that slider callbacks complete before widget destruction, or defer callback execution. Let me create the patch:\n\n--- a/lib/matplotlib/widgets.py\n+++ b/lib/matplotlib/widgets.py\n@@ -775,7 +775,12 @@ class SliderBase(AxesWidget):\n         \"\"\"\n         if self.eventson:\n             self._observers.process(self.valstep, val)\n-\n+    \n+    def _end_drag(self, event):\n+        \"\"\"Handle end of drag event.\"\"\"\n+        if self.eventson and hasattr(self, '_drag_active') and self._drag_active:\n+            self._drag_active = False\n+            self._observers.process(self.valstep, self.val)\n \n class Slider(SliderBase):\n     \"\"\"\n@@ -962,6 +967,7 @@ class Slider(SliderBase):\n         self.valinit = valinit\n \n         self._dragging = False\n+        self._drag_active = False\n \n         if orientation == \"vertical\":\n             self.orientation = \"vertical\"\n@@ -1017,11 +1023,13 @@ class Slider(SliderBase):\n         if self.drawon:\n             self.ax.figure.canvas.draw_idle()\n         if self.eventson:\n-            self._observers.process(self.eventson, val)\n+            if not self._dragging:\n+                self._observers.process(self.eventson, val)\n \n     def _update_val_from_pos(self, pos):\n         \"\"\"Update the slider value based on a given position.\"\"\"\n         if self.orientation == \"vertical\":\n+            self._drag_active = self._dragging\n             idx = np.argmin(np.abs(self._ax_pos - pos[1]))\n         else:\n             idx = np.argmin(np.abs(self._ax_pos - pos[0]))\n@@ -1036,6 +1044,7 @@ class Slider(SliderBase):\n         if not self.ignore(event):\n             self._dragging = False\n             self.set_val(self._newval)\n+            self._drag_active = False\n \n     def _onmove(self, event):\n         \"\"\"Update the slider position.\"\"\"\n@@ -1259,6 +1268,7 @@ class RangeSlider(SliderBase):\n         self.valinit = valinit\n \n         self._dragging = False\n+        self._drag_active = False\n \n         if orientation == \"vertical\":\n             self.orientation = \"vertical\"\n@@ -1342,7 +1352,8 @@ class RangeSlider(SliderBase):\n         if self.drawon:\n             self.ax.figure.canvas.draw_idle()\n         if self.eventson:\n-            self._observers.process(self.eventson, val)\n+            if not self._dragging:\n+                self._observers.process(self.eventson, val)\n \n     def _update_val_from_pos(self, pos):\n         \"\"\"Update the slider value based on a given position.\"\"\"\n@@ -1364,6 +1375,7 @@ class RangeSlider(SliderBase):\n         if not self.ignore(event):\n             self._dragging = False\n             self.set_val(self._newval)\n+            self._drag_active = False\n \n     def _onmove(self, event):\n         \"\"\"Update the slider position.\"\"\"",
  "attempts": 1,
  "success": true,
  "error": null,
  "timestamp": "2026-01-05T19:43:38.170641"
}