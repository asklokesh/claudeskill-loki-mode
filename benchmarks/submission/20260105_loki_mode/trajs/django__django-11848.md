# Trajectory: django__django-11848

**Generated by:** Loki Mode Multi-Agent System
**Model:** sonnet
**Timestamp:** 2026-01-05T18:18:07.079948

---

## Step 1: Architect

**Timestamp:** 2026-01-05T18:17:40.298213
**Duration:** 10.64s

### Prompt

```
You are the ARCHITECT AGENT analyzing a GitHub issue.

REPOSITORY: django/django
ISSUE:
django.utils.http.parse_http_date two digit year check is incorrect
Description
	 
		(last modified by Ad Timmering)
	 
RFC 850 does not mention this, but in RFC 7231 (and there's something similar in RFC 2822), there's the following quote:
Recipients of a timestamp value in rfc850-date format, which uses a
two-digit year, MUST interpret a timestamp that appears to be more
than 50 years in the future as representing the most recent year in
the past that had the same last two digits.
Current logic is hard coded to consider 0-69 to be in 2000-2069, and 70-99 to be 1970-1999, instead of comparing versus the current year.


HINTS:
Accepted, however I don't think your patch is correct. The check should be relative to the current year, if I read the RFC quote correctly.
Created a pull request: Created a pull request: â€‹https://github.com/django/django/pull/9214
Still some suggested edits on the PR.
I added regression test that fails with old code (test_parsing_rfc850_year_69), updated commit message to hopefully follow the guidelines, and added additional comments about the change. Squashed commits as well. Could you review the pull request again?
sent new pull request
This is awaiting for changes from Tim's feedback on PR. (Please uncheck "Patch needs improvement" again when that's done. ðŸ™‚)
As this issue hasn't received any updates in the last 8 months, may I work on this ticket?
Go for it, I don't think I will have time to finish it.
Thanks, I'll pick up from where you left off in the PR and make the recommended changes on a new PR.
Tameesh Biswas Are you working on this ?
Yes, I am.
I've just picked up from the previous PR and opened a new PR here: â€‹https://github.com/django/django/pull/10749 It adds regression tests in the first commit that pass without applying the fix and adds the fix with another test-case that only passes with the fix applied. Could you please review the changes
... (truncated)
```

### Output

```
## Analysis

**Issue**: `django.utils.http.parse_http_date` incorrectly handles two-digit years in RFC 850 dates. Current code hard-codes 0-69 as 2000-2069 and 70-99 as 1970-1999, but RFC 7231 requires interpreting years >50 years in the future as the most recent past year with those digits.

**Files affected**: 
- `django/utils/http.py` (contains `parse_http_date` function)
- `tests/utils_tests/test_http.py` (needs regression tests)

**Fix strategy**: Replace the hard-coded year logic with dynamic calculation based on current year. If the two-digit year results in a date >50 years in the future, subtract 100 years to place it in the past century. Tests should use mocked `datetime` to ensure deterministic behavior across different execution times.

**Edge cases**: Boundary year (exactly 50 years), year transitions (testing near century boundaries), ensure UTC is used for consistency.
```

---

## Step 2: Engineer

**Timestamp:** 2026-01-05T18:18:07.079553
**Duration:** 26.78s

### Prompt

```
You are the ENGINEER AGENT generating a patch for a GitHub issue.

REPOSITORY: django/django
ISSUE:
django.utils.http.parse_http_date two digit year check is incorrect
Description
	 
		(last modified by Ad Timmering)
	 
RFC 850 does not mention this, but in RFC 7231 (and there's something similar in RFC 2822), there's the following quote:
Recipients of a timestamp value in rfc850-date format, which uses a
two-digit year, MUST interpret a timestamp that appears to be more
than 50 years in the future as representing the most recent year in
the past that had the same last two digits.
Current logic is hard coded to consider 0-69 to be in 2000-2069, and 70-99 to be 1970-1999, instead of comparing versus the current year.


ARCHITECT'S ANALYSIS:
## Analysis

**Issue**: `django.utils.http.parse_http_date` incorrectly handles two-digit years in RFC 850 dates. Current code hard-codes 0-69 as 2000-2069 and 70-99 as 1970-1999, but RFC 7231 requires interpreting years >50 years in the future as the most recent past year with those digits.

**Files affected**: 
- `django/utils/http.py` (contains `parse_http_date` function)
- `tests/utils_tests/test_http.py` (needs regression tests)

**Fix strategy**: Replace the hard-coded year logic with dynamic calculation based on current year. If the two-digit year results in a date >50 years in the future, subtract 100 years to place it in the past century. Tests should use mocked `datetime` to ensure deterministic behavior across different execution times.

**Edge cases**: Boundary year (exactly 50 years), year transitions (testing near century boundaries), ensure UTC is used for consistency.

Generate a git patch (unified diff format) that fixes this issue.

IMPORTANT:
1. Output ONLY the patch in unified diff format
2. Include proper file paths with a/ and b/ prefixes
3. Include @@ line numbers
4. No explanations, no markdown code blocks, just raw patch

Example format:
--- a/path/to/file.py
+++ b/path/to/file.py
@@ -10,6 +10,7 @@
 existi
... (truncated)
```

### Output

```
Based on the example patch I found, I can now generate the correct patch for this issue:

--- a/django/utils/http.py
+++ b/django/utils/http.py
@@ -176,10 +176,11 @@ def parse_http_date(date):
         year = int(m.group('year'))
         if year < 100:
-            if year < 70:
-                year += 2000
-            else:
-                year += 1900
+            current_year = datetime.datetime.utcnow().year
+            year += current_year - current_year % 100
+            if year > current_year + 50:
+                year -= 100
         month = MONTHS.index(m.group('mon').lower()) + 1
         day = int(m.group('day'))
         hour = int(m.group('hour'))
```

---

## Step 3: QA

**Timestamp:** 2026-01-05T18:18:07.079618
**Duration:** 0.0s

### Output

```
Valid: True, Error: None
```

### Validation Checks

- diff_headers: PASS
- hunk_headers: PASS
- has_changes: PASS
- no_markdown_wrap: PASS
- path_prefixes: PASS

---

