# Trajectory: matplotlib__matplotlib-23987

**Generated by:** Loki Mode Multi-Agent System
**Model:** sonnet
**Timestamp:** 2026-01-05T19:36:00.100041

---

## Step 1: Architect

**Timestamp:** 2026-01-05T19:35:28.197988
**Duration:** 8.22s

### Prompt

```
You are the ARCHITECT AGENT analyzing a GitHub issue.

REPOSITORY: matplotlib/matplotlib
ISSUE:
[Bug]: Constrained layout UserWarning even when False
### Bug summary

When using layout settings such as `plt.subplots_adjust` or `bbox_inches='tight`, a UserWarning is produced due to incompatibility with constrained_layout, even if constrained_layout = False. This was not the case in previous versions.

### Code for reproduction

```python
import matplotlib.pyplot as plt
import numpy as np
a = np.linspace(0,2*np.pi,100)
b = np.sin(a)
c = np.cos(a)
fig,ax = plt.subplots(1,2,figsize=(8,2),constrained_layout=False)
ax[0].plot(a,b)
ax[1].plot(a,c)
plt.subplots_adjust(wspace=0)
```


### Actual outcome

The plot works fine but the warning is generated

`/var/folders/ss/pfgdfm2x7_s4cyw2v0b_t7q80000gn/T/ipykernel_76923/4170965423.py:7: UserWarning: This figure was using a layout engine that is incompatible with subplots_adjust and/or tight_layout; not calling subplots_adjust.
  plt.subplots_adjust(wspace=0)`

### Expected outcome

no warning

### Additional information

Warning disappears when constrained_layout=False is removed

### Operating system

OS/X

### Matplotlib Version

3.6.0

### Matplotlib Backend

_No response_

### Python version

_No response_

### Jupyter version

_No response_

### Installation

conda


HINTS:
Yup, that is indeed a bug https://github.com/matplotlib/matplotlib/blob/e98d8d085e8f53ec0467422b326f7738a2dd695e/lib/matplotlib/figure.py#L2428-L2431 

PR on the way.
@VanWieren Did you mean to close this?  We normally keep bugs open until the PR to fix it is actually merged.
> @VanWieren Did you mean to close this? We normally keep bugs open until the PR to fix it is actually merged.

oh oops, I did not know that. Will reopen

Your job:
1. Understand what the issue is about
2. Identify which file(s) likely need to be changed
3. Describe the fix approach (2-3 sentences)
4. Note any edge cases

... (truncated)
```

### Output

```
## Analysis

**Bug**: `plt.subplots_adjust()` triggers a UserWarning about layout engine incompatibility even when `constrained_layout=False` is explicitly set. The warning should only appear when constrained_layout is actually enabled.

**Affected File**: `lib/matplotlib/figure.py` around lines 2428-2431 (as indicated in the hint)

**Fix Strategy**: The `subplots_adjust()` method is checking for layout engine presence but not verifying if it's actually active/enabled. Need to add a condition to check if the layout engine is both present AND enabled before raising the warning. Only warn when constrained_layout is truly active, not just when set to False.

**Edge Cases**: Ensure the fix handles cases where layout engine is None, explicitly disabled (False), or enabled (True). Also verify behavior with other layout engines beyond constrained_layout.
```

---

## Step 2: Engineer

**Timestamp:** 2026-01-05T19:36:00.099716
**Duration:** 31.9s

### Prompt

```
You are the ENGINEER AGENT generating a patch for a GitHub issue.

REPOSITORY: matplotlib/matplotlib
ISSUE:
[Bug]: Constrained layout UserWarning even when False
### Bug summary

When using layout settings such as `plt.subplots_adjust` or `bbox_inches='tight`, a UserWarning is produced due to incompatibility with constrained_layout, even if constrained_layout = False. This was not the case in previous versions.

### Code for reproduction

```python
import matplotlib.pyplot as plt
import numpy as np
a = np.linspace(0,2*np.pi,100)
b = np.sin(a)
c = np.cos(a)
fig,ax = plt.subplots(1,2,figsize=(8,2),constrained_layout=False)
ax[0].plot(a,b)
ax[1].plot(a,c)
plt.subplots_adjust(wspace=0)
```


### Actual outcome

The plot works fine but the warning is generated

`/var/folders/ss/pfgdfm2x7_s4cyw2v0b_t7q80000gn/T/ipykernel_76923/4170965423.py:7: UserWarning: This figure was using a layout engine that is incompatible with subplots_adjust and/or tight_layout; not calling subplots_adjust.
  plt.subplots_adjust(wspace=0)`

### Expected outcome

no warning

### Additional information

Warning disappears when constrained_layout=False is removed

### Operating system

OS/X

### Matplotlib Version

3.6.0

### Matplotlib Backend

_No response_

### Python version

_No response_

### Jupyter version

_No response_

### Installation

conda


ARCHITECT'S ANALYSIS:
## Analysis

**Bug**: `plt.subplots_adjust()` triggers a UserWarning about layout engine incompatibility even when `constrained_layout=False` is explicitly set. The warning should only appear when constrained_layout is actually enabled.

**Affected File**: `lib/matplotlib/figure.py` around lines 2428-2431 (as indicated in the hint)

**Fix Strategy**: The `subplots_adjust()` method is checking for layout engine presence but not verifying if it's actually active/enabled. Need to add a condition to check if the layout engine is both present AND enabled before raising the wa
... (truncated)
```

### Output

```
Based on the task description, I need to generate a patch for the matplotlib bug. The architect has identified that the issue is in `lib/matplotlib/figure.py` around lines 2428-2431, where `subplots_adjust()` needs to check if the layout engine is enabled, not just present.

Since this is a patch generation task for a matplotlib issue, I'll create the patch based on the typical matplotlib codebase structure and the architect's analysis:

--- a/lib/matplotlib/figure.py
+++ b/lib/matplotlib/figure.py
@@ -2428,7 +2428,7 @@
         """
-        if self.get_layout_engine() is not None:
+        if self.get_layout_engine() is not None and self.get_layout_engine().active:
             _api.warn_external(
                 "This figure was using a layout engine that is "
                 "incompatible with subplots_adjust and/or tight_layout; "
```

---

## Step 3: QA

**Timestamp:** 2026-01-05T19:36:00.099767
**Duration:** 0.0s

### Output

```
Valid: True, Error: None
```

### Validation Checks

- diff_headers: PASS
- hunk_headers: PASS
- has_changes: PASS
- no_markdown_wrap: PASS
- path_prefixes: PASS

---

