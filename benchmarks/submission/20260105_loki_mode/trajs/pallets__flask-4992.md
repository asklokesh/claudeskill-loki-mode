# Trajectory: pallets__flask-4992

**Generated by:** Loki Mode Multi-Agent System
**Model:** sonnet
**Timestamp:** 2026-01-05T19:53:16.493662

---

## Step 1: Architect

**Timestamp:** 2026-01-05T19:52:30.205646
**Duration:** 8.06s

### Prompt

```
You are the ARCHITECT AGENT analyzing a GitHub issue.

REPOSITORY: pallets/flask
ISSUE:
Add a file mode parameter to flask.Config.from_file()
Python 3.11 introduced native TOML support with the `tomllib` package. This could work nicely with the `flask.Config.from_file()` method as an easy way to load TOML config files:

```python
app.config.from_file("config.toml", tomllib.load)
```

However, `tomllib.load()` takes an object readable in binary mode, while `flask.Config.from_file()` opens a file in text mode, resulting in this error:

```
TypeError: File must be opened in binary mode, e.g. use `open('foo.toml', 'rb')`
```

We can get around this with a more verbose expression, like loading from a file opened with the built-in `open()` function and passing the `dict` to `app.Config.from_mapping()`:

```python
# We have to repeat the path joining that from_file() does
with open(os.path.join(app.config.root_path, "config.toml"), "rb") as file:
    app.config.from_mapping(tomllib.load(file))
```

But adding a file mode parameter to `flask.Config.from_file()` would enable the use of a simpler expression. E.g.:

```python
app.config.from_file("config.toml", tomllib.load, mode="b")
```



HINTS:
You can also use:

```python
app.config.from_file("config.toml", lambda f: tomllib.load(f.buffer))
```
Thanks - I was looking for another way to do it. I'm happy with that for now, although it's worth noting this about `io.TextIOBase.buffer` from the docs:

> This is not part of the [TextIOBase](https://docs.python.org/3/library/io.html#io.TextIOBase) API and may not exist in some implementations.
Oh, didn't mean for you to close this, that was just a shorter workaround. I think a `text=True` parameter would be better, easier to use `True` or `False` rather than mode strings. Some libraries, like `tomllib`, have _Opinions_ about whether text or bytes are correct for parsing files, and we can accommodate that.
can i work on this?
No need to ask to work 
... (truncated)
```

### Output

```
## Issue Analysis

**Problem**: `flask.Config.from_file()` currently opens files in text mode only, but some loaders like Python 3.11's `tomllib.load()` require binary mode. This prevents users from using the convenient one-liner syntax with TOML files.

**Files Affected**:
- `src/flask/config.py` - Contains the `Config.from_file()` method that needs modification

**Fix Strategy**: Add a `text` parameter (boolean, defaults to `True`) to `Config.from_file()` that controls whether the file is opened in text or binary mode. When `text=False`, open with `"rb"` mode instead of `"r"`, allowing binary loaders like `tomllib.load()` to work directly.

**Edge Cases**: 
- Ensure backward compatibility (default `text=True` maintains current behavior)
- Parameter naming should follow maintainer preference (`text=True` vs `mode="rb"` - discussion indicates `text=True` is preferred)
```

---

## Step 2: Engineer

**Timestamp:** 2026-01-05T19:53:16.493416
**Duration:** 46.29s

### Prompt

```
You are the ENGINEER AGENT generating a patch for a GitHub issue.

REPOSITORY: pallets/flask
ISSUE:
Add a file mode parameter to flask.Config.from_file()
Python 3.11 introduced native TOML support with the `tomllib` package. This could work nicely with the `flask.Config.from_file()` method as an easy way to load TOML config files:

```python
app.config.from_file("config.toml", tomllib.load)
```

However, `tomllib.load()` takes an object readable in binary mode, while `flask.Config.from_file()` opens a file in text mode, resulting in this error:

```
TypeError: File must be opened in binary mode, e.g. use `open('foo.toml', 'rb')`
```

We can get around this with a more verbose expression, like loading from a file opened with the built-in `open()` function and passing the `dict` to `app.Config.from_mapping()`:

```python
# We have to repeat the path joining that from_file() does
with open(os.path.join(app.config.root_path, "config.toml"), "rb") as file:
    app.config.from_mapping(tomllib.load(file))
```

But adding a file mode parameter to `flask.Config.from_file()` would enable the use of a simpler expression. E.g.:

```python
app.config.from_file("config.toml", tomllib.load, mode="b")
```



ARCHITECT'S ANALYSIS:
## Issue Analysis

**Problem**: `flask.Config.from_file()` currently opens files in text mode only, but some loaders like Python 3.11's `tomllib.load()` require binary mode. This prevents users from using the convenient one-liner syntax with TOML files.

**Files Affected**:
- `src/flask/config.py` - Contains the `Config.from_file()` method that needs modification

**Fix Strategy**: Add a `text` parameter (boolean, defaults to `True`) to `Config.from_file()` that controls whether the file is opened in text or binary mode. When `text=False`, open with `"rb"` mode instead of `"r"`, allowing binary loaders like `tomllib.load()` to work directly.

**Edge Cases**: 
- Ensure backward compatibility (default `text=True` maintains current be
... (truncated)
```

### Output

```
Based on my knowledge of Flask's Config class and the issue description, I'll generate the patch. The `from_file()` method needs to accept a `text` parameter to control binary vs text mode file opening.

--- a/src/flask/config.py
+++ b/src/flask/config.py
@@ -240,7 +240,7 @@ class Config(dict):
         self.from_mapping(mapping)
         return True
 
-    def from_file(self, filename: str, load: t.Callable[[t.IO[t.Any]], t.Mapping], silent: bool = False) -> bool:
+    def from_file(self, filename: str, load: t.Callable[[t.IO[t.Any]], t.Mapping], silent: bool = False, text: bool = True) -> bool:
         """Update the values in the config from a file that is loaded
         using the ``load`` parameter. The loaded data is passed to the
         :meth:`from_mapping` method.
@@ -259,6 +259,10 @@ class Config(dict):
             import json
             app.config.from_file("config.json", load=json.load)
 
+            import tomllib
+            app.config.from_file("config.toml", load=tomllib.load, text=False)
+
+        .. versionchanged:: 2.3
+            The ``text`` parameter was added.
 
         .. versionadded:: 2.0
 
@@ -266,13 +270,14 @@ class Config(dict):
             The name of the file to load.
         :param load: A callable that takes a file handle and returns a
             mapping of loaded data from the file.
-        :type load: ``Callable[[Reader], Mapping]`` where ``Reader``
-            implements a ``read`` method.
+        :param text: Open the file in text or binary mode.
         :param silent: Ignore the file if it doesn't exist.
         :return: ``True`` if the file was loaded successfully.
         """
         filename = os.path.join(self.root_path, filename)
 
         try:
-            with open(filename) as f:
+            with open(filename, "r" if text else "rb") as f:
                 obj = load(f)
         except OSError as e:
```

---

## Step 3: QA

**Timestamp:** 2026-01-05T19:53:16.493456
**Duration:** 0.0s

### Output

```
Valid: True, Error: None
```

### Validation Checks

- diff_headers: PASS
- hunk_headers: PASS
- has_changes: PASS
- no_markdown_wrap: PASS
- path_prefixes: PASS

---

