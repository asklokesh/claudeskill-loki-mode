# pytest-dev__pytest-7490
# Loki Mode Multi-Agent Patch
# Attempts: 1

Now I have the exact context. The `pytest_runtest_call` function has:

```python
@hookimpl(hookwrapper=True)
def pytest_runtest_call(item: Item) -> Generator[None, None, None]:
    xfailed = item._store.get(xfailed_key, None)
    if xfailed is None:
        item._store[xfailed_key] = xfailed = evaluate_xfail_marks(item)

    if not item.config.option.runxfail:
        if xfailed and not xfailed.run:
            xfail("[NOTRUN] " + xfailed.reason)

    yield
```

And then `@hookimpl(hookwrapper=True)` starts the next function.

The fix is to add re-evaluation after yield:

--- a/src/_pytest/skipping.py
+++ b/src/_pytest/skipping.py
@@ -247,6 +247,11 @@ def pytest_runtest_call(item: Item) -> Generator[None, None, None]:
             xfail("[NOTRUN] " + xfailed.reason)
 
     yield
+
+    # The test run may have added an xfail mark dynamically.
+    xfailed = item._store.get(xfailed_key, None)
+    if xfailed is None:
+        item._store[xfailed_key] = evaluate_xfail_marks(item)
 
 
 @hookimpl(hookwrapper=True)