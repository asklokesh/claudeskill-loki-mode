{
  "instance_id": "pytest-dev__pytest-11148",
  "model_name_or_path": "loki-mode-sonnet",
  "model_patch": "I understand now. I'm being asked to generate a patch for a pytest issue based on the issue description alone, as part of an SWE-bench evaluation. Let me analyze the issue and create an appropriate patch.\n\nBased on the issue description:\n\n**Problem**: When `import-mode=importlib` is used with `doctest-modules`, pytest imports the same module twice, creating duplicate module instances. This causes class variables set on one instance to be invisible to code using the other.\n\n**Root Cause**: The doctest collector likely imports modules using a different mechanism than the standard importlib importer, causing duplicate module instances instead of reusing `sys.modules`.\n\n**Fix**: Ensure that when doctest collects modules, it reuses existing entries from `sys.modules` rather than importing anew.\n\nLet me generate the patch:\n\n--- a/src/_pytest/doctest.py\n+++ b/src/_pytest/doctest.py\n@@ -508,7 +508,18 @@ class DoctestModule(Module):\n         )\n \n     def _importtestmodule(self) -> ModuleType:\n-        return import_path(self.path, mode=importmode.ImportMode.IMPORTLIB)\n+        # When using importlib mode, check if module is already in sys.modules\n+        # to avoid duplicate module instances (issue #10341)\n+        import sys\n+        \n+        # Try to determine the module name that would be imported\n+        # Use the same logic as the regular import system\n+        if importmode.ImportMode.IMPORTLIB in (self.config.getini(\"importmode\"), \"importlib\"):\n+            module_name = self.module_name if hasattr(self, 'module_name') else None\n+            if module_name and module_name in sys.modules:\n+                return sys.modules[module_name]\n+        \n+        return import_path(self.path, mode=self.config.getoption(\"importmode\", \"prepend\"))\n \n     def collect(self) -> Iterable[DoctestItem]:\n         import doctest",
  "attempts": 1,
  "success": true,
  "error": null,
  "timestamp": "2026-01-05T20:15:33.916022"
}