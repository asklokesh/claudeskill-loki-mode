{
  "instance_id": "sphinx-doc__sphinx-8435",
  "model_name_or_path": "loki-mode-sonnet",
  "model_patch": "Based on my analysis of the task and the repository structure, I understand that I'm being asked to generate a patch for the Sphinx issue sphinx-doc__sphinx-8435. The Explore agent provided comprehensive information about where the bug is and how to fix it.\n\nThe issue is that `autodoc_type_aliases` is not being applied to module-level variables (DataDocumenter) and class attributes (AttributeDocumenter) because they're using `getattr(self.parent, '__annotations__', {})` instead of calling `get_type_hints()` with the type aliases configuration.\n\nHere's the patch:\n\n--- a/sphinx/ext/autodoc/__init__.py\n+++ b/sphinx/ext/autodoc/__init__.py\n@@ -1695,13 +1695,17 @@ class DataDocumenter(ModuleLevelDocumenter):\n     def add_directive_header(self, sig: str) -> None:\n         super().add_directive_header(sig)\n         sourcename = self.get_sourcename()\n+\n+        # obtain type annotation for this data with type alias support\n+        try:\n+            annotations = get_type_hints(self.parent, None, self.config.autodoc_type_aliases)\n+        except Exception:\n+            annotations = {}\n+\n         if self.options.annotation is SUPPRESS:\n             pass\n         elif self.options.annotation:\n             self.add_line('   :annotation: ' + self.options.annotation, sourcename)\n         else:\n-            # obtain annotation for this data\n-            annotations = getattr(self.parent, '__annotations__', {})\n             if self.objpath[-1] in annotations:\n                 objrepr = stringify_typehint(annotations.get(self.objpath[-1]))\n                 self.add_line('   :type: ' + objrepr, sourcename)\n@@ -1857,13 +1861,17 @@ class AttributeDocumenter(DocstringStripSignatureMixin, ClassLevelDocumenter):\n     def add_directive_header(self, sig: str) -> None:\n         super().add_directive_header(sig)\n         sourcename = self.get_sourcename()\n+\n+        # obtain type annotation for this attribute with type alias support\n+        try:\n+            annotations = get_type_hints(self.parent, None, self.config.autodoc_type_aliases)\n+        except Exception:\n+            annotations = {}\n+\n         if self.options.annotation is SUPPRESS:\n             pass\n         elif self.options.annotation:\n             self.add_line('   :annotation: ' + self.options.annotation, sourcename)\n         else:\n-            # obtain annotation for this attribute\n-            annotations = getattr(self.parent, '__annotations__', {})\n             if self.objpath[-1] in annotations:\n                 objrepr = stringify_typehint(annotations.get(self.objpath[-1]))\n                 self.add_line('   :type: ' + objrepr, sourcename)",
  "attempts": 1,
  "success": true,
  "error": null,
  "timestamp": "2026-01-05T20:55:51.163412"
}