{
  "instance_id": "scikit-learn__scikit-learn-15512",
  "model_name_or_path": "loki-mode-sonnet",
  "model_patch": "Based on the issue description and the architect's analysis, I'll generate a proper patch for the AffinityPropagation convergence issue:\n\n--- a/sklearn/cluster/affinity_propagation_.py\n+++ b/sklearn/cluster/affinity_propagation_.py\n@@ -195,6 +195,9 @@ def affinity_propagation(S, preference=None, convergence_iter=15, max_iter=200,\n             if verbose:\n                 print(\"Converged after %d iterations.\" % it)\n             break\n+    else:\n+        if verbose:\n+            print(\"Did not converge\")\n \n     I = np.flatnonzero(E)\n     K = I.size  # Identify exemplars\n@@ -213,9 +216,11 @@ def affinity_propagation(S, preference=None, convergence_iter=15, max_iter=200,\n             labels[I[k]] = k\n \n         cluster_centers_indices = I\n+        converged = it < max_iter - 1\n     else:\n         warnings.warn(\"Affinity propagation did not converge, this model \"\n                       \"will not have any cluster centers.\", ConvergenceWarning)\n+        converged = False\n         cluster_centers_indices = np.array([])\n         labels = np.array([-1] * n_samples)\n \n@@ -304,6 +309,10 @@ class AffinityPropagation(BaseEstimator, ClusterMixin):\n     n_iter_ : int\n         Number of iterations taken to converge.\n \n+    converged_ : bool\n+        Whether the algorithm converged. If False, cluster_centers_indices_\n+        will be empty and labels_ will be -1 for all samples.\n+\n     Examples\n     --------\n     >>> from sklearn.cluster import AffinityPropagation\n@@ -352,8 +361,17 @@ class AffinityPropagation(BaseEstimator, ClusterMixin):\n                 \"affinity matrix, got %s\" % self.affinity)\n         self.cluster_centers_indices_, self.labels_, self.n_iter_ = \\\n             affinity_propagation(\n-                self.affinity_matrix_, self.preference, max_iter=self.max_iter,\n+                self.affinity_matrix_, self.preference,\n                 convergence_iter=self.convergence_iter, damping=self.damping,\n-                copy=self.copy, verbose=self.verbose, return_n_iter=True)\n+                max_iter=self.max_iter, copy=self.copy, verbose=self.verbose,\n+                return_n_iter=True)\n+\n+        if self.n_iter_ == self.max_iter:\n+            warnings.warn(\"Affinity propagation did not converge, this model \"\n+                          \"will not have any cluster centers.\",\n+                          ConvergenceWarning)\n+            self.cluster_centers_indices_ = np.array([])\n+            self.labels_ = np.full(X.shape[0], -1)\n+            self.converged_ = False\n+        else:\n+            self.converged_ = True\n \n         if self.affinity != \"precomputed\":",
  "attempts": 1,
  "success": true,
  "error": null,
  "timestamp": "2026-01-05T20:39:53.493118"
}