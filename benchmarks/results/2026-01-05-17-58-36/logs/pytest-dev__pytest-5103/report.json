{
  "instance_id": "pytest-dev__pytest-5103",
  "model_name_or_path": "loki-mode-sonnet",
  "model_patch": "--- a/src/_pytest/assertion/rewrite.py\n+++ b/src/_pytest/assertion/rewrite.py\n@@ -876,6 +876,16 @@ class AssertionRewriter(ast.NodeVisitor):\n         if isinstance(assert_.test, ast.Tuple) and len(assert_.test.elts) >= 1:\n             from _pytest.warning_types import PytestAssertRewriteWarning\n             import warnings\n+\n+        # Check if this is an all() or any() call with a comprehension\n+        if self._is_all_any_call(assert_.test):\n+            new_stmts = self._unroll_all_any(assert_)\n+            if new_stmts:\n+                return new_stmts\n+\n+        if isinstance(assert_.test, ast.Tuple) and len(assert_.test.elts) >= 1:\n+            from _pytest.warning_types import PytestAssertRewriteWarning\n+            import warnings\n             warnings.warn_explicit(\n                 PytestAssertRewriteWarning(\n                     \"assertion is always true, perhaps remove parentheses?\"\n@@ -942,6 +952,82 @@ class AssertionRewriter(ast.NodeVisitor):\n         # Clear temporary variables by setting them to None.\n         self.statements.append(ast.Assign([tmpvar], ast.NameConstant(None)))\n \n+    def _is_all_any_call(self, node):\n+        \"\"\"Check if node is a call to all() or any() with a comprehension.\"\"\"\n+        if not isinstance(node, ast.Call):\n+            return False\n+        if not isinstance(node.func, ast.Name):\n+            return False\n+        if node.func.id not in (\"all\", \"any\"):\n+            return False\n+        if len(node.args) != 1:\n+            return False\n+        arg = node.args[0]\n+        return isinstance(arg, (ast.GeneratorExp, ast.ListComp))\n+\n+    def _unroll_all_any(self, assert_):\n+        \"\"\"Transform all()/any() with comprehension into a for loop with assertions.\"\"\"\n+        call = assert_.test\n+        func_name = call.func.id\n+        comp = call.args[0]\n+\n+        # Extract the element, iterator, and test expression\n+        if isinstance(comp, ast.GeneratorExp):\n+            elt = comp.elt\n+            generators = comp.generators\n+        elif isinstance(comp, ast.ListComp):\n+            elt = comp.elt\n+            generators = comp.generators\n+        else:\n+            return None\n+\n+        # Only handle simple cases for now (single generator, no ifs)\n+        if len(generators) != 1:\n+            return None\n+\n+        generator = generators[0]\n+        if generator.ifs:\n+            # Handle filter conditions by wrapping in an if statement\n+            conditions = generator.ifs\n+        else:\n+            conditions = []\n+\n+        target = generator.target\n+        iter_node = generator.iter\n+\n+        # Create a new assertion for each element\n+        if func_name == \"all\":\n+            # all(expr for x in iter) -> for x in iter: assert expr\n+            inner_assert = ast.Assert(test=elt, msg=assert_.msg)\n+            inner_assert.lineno = assert_.lineno\n+            inner_assert.col_offset = assert_.col_offset\n+        else:\n+            # any(expr for x in iter) -> for x in iter: if expr: break else: assert False\n+            # We need a flag to track if any was true\n+            flag_name = f\"@py_any_found_{next(self.variable_counter)}\"\n+            flag_var = ast.Name(flag_name, ast.Store())\n+            init_flag = ast.Assign([flag_var], ast.NameConstant(False))\n+            init_flag.lineno = assert_.lineno\n+\n+            set_flag = ast.Assign([ast.Name(flag_name, ast.Store())], ast.NameConstant(True))\n+            set_flag.lineno = assert_.lineno\n+\n+            if_stmt = ast.If(test=elt, body=[set_flag, ast.Break()], orelse=[])\n+            if_stmt.lineno = assert_.lineno\n+\n+            check_flag = ast.Assert(test=ast.Name(flag_name, ast.Load()), msg=assert_.msg)\n+            check_flag.lineno = assert_.lineno\n+\n+        if func_name == \"all\":\n+            body = [inner_assert] if not conditions else [ast.If(test=ast.BoolOp(ast.And(), conditions) if len(conditions) > 1 else conditions[0], body=[inner_assert], orelse=[])]\n+            for_loop = ast.For(target=target, iter=iter_node, body=body, orelse=[])\n+            for_loop.lineno = assert_.lineno\n+            return [for_loop]\n+        else:\n+            body = [if_stmt] if not conditions else [ast.If(test=ast.BoolOp(ast.And(), conditions) if len(conditions) > 1 else conditions[0], body=[if_stmt], orelse=[])]\n+            for_loop = ast.For(target=target, iter=iter_node, body=body, orelse=[check_flag])\n+            for_loop.lineno = assert_.lineno\n+            return [init_flag, for_loop]\n+\n     def visit_Name(self, name):\n         # Display the repr of the name if it's a local variable or\n         # _should_repr_global_name() thinks it's acceptable.",
  "attempts": 1,
  "success": true,
  "error": null,
  "timestamp": "2026-01-05T20:16:40.498746"
}