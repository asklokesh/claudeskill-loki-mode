{
  "instance_id": "pytest-dev__pytest-7220",
  "model_name_or_path": "loki-mode-sonnet",
  "model_patch": "Based on my analysis of pytest's architecture and the issue description, I can generate the patch. The issue is that pytest uses `os.getcwd()` when formatting paths for display, which causes paths to be shown relative to the changed directory instead of the original invocation directory.\n\n--- a/src/_pytest/nodes.py\n+++ b/src/_pytest/nodes.py\n@@ -347,7 +347,7 @@ class Node(metaclass=NodeMeta):\n         \"\"\"\n         try:\n             return self._nodeid\n-        except AttributeError:\n+        except AttributeError: \n             self._nodeid = self._makeid()\n             return self._nodeid\n \n@@ -453,7 +453,7 @@ class FSCollector(Collector):\n     def _getobj(self):\n         return getattr(self.obj, 'obj', None)\n \n-    def _makeid(self):\n+    def _makeid(self): \n         \"\"\"Return a unique identifier for this node.\"\"\"\n         relpath = self.session.config.rootpath.bestrelpath(self.path)\n         return relpath.as_posix()\n--- a/src/_pytest/reports.py\n+++ b/src/_pytest/reports.py\n@@ -1,6 +1,7 @@\n \"\"\"Report test results in different formats.\"\"\"\n from io import StringIO\n from pprint import pprint\n+from pathlib import Path\n from typing import Any\n from typing import Dict\n from typing import Generic\n@@ -216,6 +217,11 @@ class BaseReport:\n         # can contain an arbitrary number of lines.\n         longrepr = cast(TerminalRepr, longrepr)\n         try:\n+            # Always use the session's invocation directory for path calculation\n+            # to avoid displaying incorrect relative paths when cwd changes in fixtures\n+            if hasattr(self, 'fspath') and self.fspath:\n+                # Ensure fspath is always relative to the original invocation directory\n+                self.fspath = str(Path(self.fspath).resolve().relative_to(Path.cwd().resolve()))\n             longrepr.toterminal(tw)\n         except UnicodeEncodeError:\n             msg = \"<unprintable longrepr>\"\n--- a/src/_pytest/terminal.py\n+++ b/src/_pytest/terminal.py\n@@ -1,6 +1,7 @@\n \"\"\"Terminal reporting of the full testing process.\"\"\"\n import argparse\n import datetime\n+import os\n from pathlib import Path\n from typing import Any\n from typing import Callable\n@@ -47,6 +48,7 @@ class TerminalReporter:\n         self.config = config\n         self._tw = _create_terminal_writer(config)\n         self.currentfspath = None\n+        self._invocation_dir = Path.cwd()  # Store the initial working directory\n         self.reportchars = getreportchars(config)\n         self.hasmarkup = self._tw.hasmarkup\n         self.isatty = file.isatty()\n@@ -389,7 +391,12 @@ class TerminalReporter:\n             return \"\"\n \n         try:\n-            relpath = bestrelpath(self.startpath, path)\n+            # Always calculate relative path from the stored invocation directory\n+            # to prevent incorrect paths when fixtures change the working directory\n+            saved_cwd = Path.cwd()\n+            os.chdir(self._invocation_dir)\n+            relpath = bestrelpath(self._invocation_dir, path)\n+            os.chdir(saved_cwd)\n         except ValueError:\n             return str(path)\n         return bestrelpath(self.startpath, path)",
  "attempts": 1,
  "success": true,
  "error": null,
  "timestamp": "2026-01-05T20:22:58.971790"
}