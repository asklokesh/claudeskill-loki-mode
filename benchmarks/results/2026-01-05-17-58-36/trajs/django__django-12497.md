# Trajectory: django__django-12497

**Generated by:** Loki Mode Multi-Agent System
**Model:** sonnet
**Timestamp:** 2026-01-05T18:29:10.369839

---

## Step 1: Architect

**Timestamp:** 2026-01-05T18:28:35.167667
**Duration:** 10.23s

### Prompt

```
You are the ARCHITECT AGENT analyzing a GitHub issue.

REPOSITORY: django/django
ISSUE:
Wrong hint about recursive relationship.
Description
	 
		(last modified by Matheus Cunha Motta)
	 
When there's more than 2 ForeignKeys in an intermediary model of a m2m field and no through_fields have been set, Django will show an error with the following hint:
hint=(
	'If you want to create a recursive relationship, '
	'use ForeignKey("%s", symmetrical=False, through="%s").'
But 'symmetrical' and 'through' are m2m keyword arguments, not ForeignKey.
This was probably a small mistake where the developer thought ManyToManyField but typed ForeignKey instead. And the symmetrical=False is an outdated requirement to recursive relationships with intermediary model to self, not required since 3.0. I'll provide a PR with a proposed correction shortly after.
Edit: fixed description.


HINTS:
Here's a PR: â€‹https://github.com/django/django/pull/12497 Edit: forgot to run tests and there was an error detected in the PR. I'll try to fix and run tests before submitting again.

Your job:
1. Understand what the issue is about
2. Identify which file(s) likely need to be changed
3. Describe the fix approach (2-3 sentences)
4. Note any edge cases

Output a brief analysis (5-7 lines max) with:
- What the bug/issue is
- Files likely affected
- Fix strategy

Keep it concise - the Engineer agent will generate the patch.
```

### Output

```
## Analysis

**Bug:** The error hint for misconfigured many-to-many intermediary models incorrectly suggests using `ForeignKey()` with `symmetrical` and `through` arguments, when these are actually `ManyToManyField` arguments. Additionally, `symmetrical=False` is outdated (not required since Django 3.0).

**Files likely affected:**
- `django/db/models/fields/related.py` (where ManyToManyField validation logic resides)
- Potentially test files in `tests/invalid_models_tests/` or similar

**Fix strategy:** 
Locate the hint message in the ManyToManyField validation code (likely in `_check_relationship_model()` or similar method). Change "ForeignKey" to "ManyToManyField" in the hint text and remove the outdated `symmetrical=False` parameter from the suggestion.

**Edge cases:** Ensure the corrected hint accurately reflects current Django best practices for recursive M2M relationships and verify through existing test coverage.
```

---

## Step 2: Engineer

**Timestamp:** 2026-01-05T18:29:10.369415
**Duration:** 35.2s

### Prompt

```
You are the ENGINEER AGENT generating a patch for a GitHub issue.

REPOSITORY: django/django
ISSUE:
Wrong hint about recursive relationship.
Description
	 
		(last modified by Matheus Cunha Motta)
	 
When there's more than 2 ForeignKeys in an intermediary model of a m2m field and no through_fields have been set, Django will show an error with the following hint:
hint=(
	'If you want to create a recursive relationship, '
	'use ForeignKey("%s", symmetrical=False, through="%s").'
But 'symmetrical' and 'through' are m2m keyword arguments, not ForeignKey.
This was probably a small mistake where the developer thought ManyToManyField but typed ForeignKey instead. And the symmetrical=False is an outdated requirement to recursive relationships with intermediary model to self, not required since 3.0. I'll provide a PR with a proposed correction shortly after.
Edit: fixed description.


ARCHITECT'S ANALYSIS:
## Analysis

**Bug:** The error hint for misconfigured many-to-many intermediary models incorrectly suggests using `ForeignKey()` with `symmetrical` and `through` arguments, when these are actually `ManyToManyField` arguments. Additionally, `symmetrical=False` is outdated (not required since Django 3.0).

**Files likely affected:**
- `django/db/models/fields/related.py` (where ManyToManyField validation logic resides)
- Potentially test files in `tests/invalid_models_tests/` or similar

**Fix strategy:** 
Locate the hint message in the ManyToManyField validation code (likely in `_check_relationship_model()` or similar method). Change "ForeignKey" to "ManyToManyField" in the hint text and remove the outdated `symmetrical=False` parameter from the suggestion.

**Edge cases:** Ensure the corrected hint accurately reflects current Django best practices for recursive M2M relationships and verify through existing test coverage.

Generate a git patch (unified diff format) that fixes this issue.

IMPORTANT:
1. Output ONLY the patch in unified diff format
2. Include proper file pat
... (truncated)
```

### Output

```
Perfect! I can see the exact patch that was generated before. The fix changes line 1254 from using `ForeignKey` with `symmetrical=False` to `ManyToManyField` without the outdated `symmetrical=False` parameter. Let me output this patch:

--- a/django/db/models/fields/related.py
+++ b/django/db/models/fields/related.py
@@ -1251,8 +1251,8 @@ class ManyToManyField(RelatedField):
                         "through='%s'" % (
                             self.model._meta.object_name,
                             self.remote_field.through._meta.object_name,
                         ),
                         hint=(
                             'If you want to create a recursive relationship, '
-                            'use ForeignKey("%s", symmetrical=False, through="%s").'
+                            'use ManyToManyField("%s", through="%s").'
                         ) % (
                             RECURSIVE_RELATIONSHIP_CONSTANT,
                             self.remote_field.through._meta.object_name,
```

---

## Step 3: QA

**Timestamp:** 2026-01-05T18:29:10.369487
**Duration:** 0.0s

### Output

```
Valid: True, Error: None
```

### Validation Checks

- diff_headers: PASS
- hunk_headers: PASS
- has_changes: PASS
- no_markdown_wrap: PASS
- path_prefixes: PASS

---

