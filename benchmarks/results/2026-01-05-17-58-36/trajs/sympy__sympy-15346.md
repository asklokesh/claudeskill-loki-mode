# Trajectory: sympy__sympy-15346

**Generated by:** Loki Mode Multi-Agent System
**Model:** sonnet
**Timestamp:** 2026-01-05T21:31:11.739970

---

## Step 1: Architect

**Timestamp:** 2026-01-05T21:30:37.616264
**Duration:** 9.43s

### Prompt

```
You are the ARCHITECT AGENT analyzing a GitHub issue.

REPOSITORY: sympy/sympy
ISSUE:
can't simplify sin/cos with Rational?
latest cloned sympy, python 3 on windows
firstly, cos, sin with symbols can be simplified; rational number can be simplified
```python
from sympy import *

x, y = symbols('x, y', real=True)
r = sin(x)*sin(y) + cos(x)*cos(y)
print(r)
print(r.simplify())
print()

r = Rational(1, 50) - Rational(1, 25)
print(r)
print(r.simplify())
print()
```
says
```cmd
sin(x)*sin(y) + cos(x)*cos(y)
cos(x - y)

-1/50
-1/50
```

but
```python
t1 = Matrix([sin(Rational(1, 50)), cos(Rational(1, 50)), 0])
t2 = Matrix([sin(Rational(1, 25)), cos(Rational(1, 25)), 0])
r = t1.dot(t2)
print(r)
print(r.simplify())
print()

r = sin(Rational(1, 50))*sin(Rational(1, 25)) + cos(Rational(1, 50))*cos(Rational(1, 25))
print(r)
print(r.simplify())
print()

print(acos(r))
print(acos(r).simplify())
print()
```
says
```cmd
sin(1/50)*sin(1/25) + cos(1/50)*cos(1/25)
sin(1/50)*sin(1/25) + cos(1/50)*cos(1/25)

sin(1/50)*sin(1/25) + cos(1/50)*cos(1/25)
sin(1/50)*sin(1/25) + cos(1/50)*cos(1/25)

acos(sin(1/50)*sin(1/25) + cos(1/50)*cos(1/25))
acos(sin(1/50)*sin(1/25) + cos(1/50)*cos(1/25))
```




HINTS:
some can be simplified
```python
from sympy import *

t1 = Matrix([sin(Rational(1, 50)), cos(Rational(1, 50)), 0])
t2 = Matrix([sin(Rational(2, 50)), cos(Rational(2, 50)), 0])
t3 = Matrix([sin(Rational(3, 50)), cos(Rational(3, 50)), 0])

r1 = t1.dot(t2)
print(r1)
print(r1.simplify())
print()

r2 = t2.dot(t3)
print(r2)
print(r2.simplify())
print()
```
says
```
sin(1/50)*sin(1/25) + cos(1/50)*cos(1/25)
sin(1/50)*sin(1/25) + cos(1/50)*cos(1/25)

sin(1/25)*sin(3/50) + cos(1/25)*cos(3/50)
cos(1/50)
```
Trigonometric simplifications are performed by `trigsimp`. It works by calling sequentially functions defined in the `fu` module. This particular simplification is carried out by `TR10i` which comes right after `TRmorr
... (truncated)
```

### Output

```
## Analysis

**Issue**: SymPy's `trigsimp()` fails to simplify `sin(a)*sin(b) + cos(a)*cos(b)` to `cos(a-b)` when `a` and `b` are rational numbers, though it works with symbolic expressions. The problem occurs because `TRmorrie` transforms the expression into a form that prevents `TR10i` from recognizing the cos sum pattern.

**Files affected**:
- `sympy/simplify/trigsimp.py` (lines ~1131-1164 where the transformation sequence is defined)

**Fix strategy**: Swap the order of `TRmorrie` and `TR10i` in the transformation pipeline so that `TR10i` can apply the `cos(a-b)` pattern before `TRmorrie` performs its specialized Morrie's law transformation. This allows the simpler, more general pattern to be matched first.

**Edge cases**: Need to verify that reordering doesn't break cases where `TRmorrie` is specifically needed, particularly expressions like `cos(x)*cos(2*x)*...*cos(2^(k-1)*x)` that should simplify using Morrie's law.
```

---

## Step 2: Engineer

**Timestamp:** 2026-01-05T21:31:11.739363
**Duration:** 34.12s

### Prompt

```
You are the ENGINEER AGENT generating a patch for a GitHub issue.

REPOSITORY: sympy/sympy
ISSUE:
can't simplify sin/cos with Rational?
latest cloned sympy, python 3 on windows
firstly, cos, sin with symbols can be simplified; rational number can be simplified
```python
from sympy import *

x, y = symbols('x, y', real=True)
r = sin(x)*sin(y) + cos(x)*cos(y)
print(r)
print(r.simplify())
print()

r = Rational(1, 50) - Rational(1, 25)
print(r)
print(r.simplify())
print()
```
says
```cmd
sin(x)*sin(y) + cos(x)*cos(y)
cos(x - y)

-1/50
-1/50
```

but
```python
t1 = Matrix([sin(Rational(1, 50)), cos(Rational(1, 50)), 0])
t2 = Matrix([sin(Rational(1, 25)), cos(Rational(1, 25)), 0])
r = t1.dot(t2)
print(r)
print(r.simplify())
print()

r = sin(Rational(1, 50))*sin(Rational(1, 25)) + cos(Rational(1, 50))*cos(Rational(1, 25))
print(r)
print(r.simplify())
print()

print(acos(r))
print(acos(r).simplify())
print()
```
says
```cmd
sin(1/50)*sin(1/25) + cos(1/50)*cos(1/25)
sin(1/50)*sin(1/25) + cos(1/50)*cos(1/25)

sin(1/50)*sin(1/25) + cos(1/50)*cos(1/25)
sin(1/50)*sin(1/25) + cos(1/50)*cos(1/25)

acos(sin(1/50)*sin(1/25) + cos(1/50)*cos(1/25))
acos(sin(1/50)*sin(1/25) + cos(1/50)*cos(1/25))
```




ARCHITECT'S ANALYSIS:
## Analysis

**Issue**: SymPy's `trigsimp()` fails to simplify `sin(a)*sin(b) + cos(a)*cos(b)` to `cos(a-b)` when `a` and `b` are rational numbers, though it works with symbolic expressions. The problem occurs because `TRmorrie` transforms the expression into a form that prevents `TR10i` from recognizing the cos sum pattern.

**Files affected**:
- `sympy/simplify/trigsimp.py` (lines ~1131-1164 where the transformation sequence is defined)

**Fix strategy**: Swap the order of `TRmorrie` and `TR10i` in the transformation pipeline so that `TR10i` can apply the `cos(a-b)` pattern before `TRmorrie` performs its specialized Morrie's law transformation. This allows the simpler, more general pattern to be matched firs
... (truncated)
```

### Output

```
Based on the architect's analysis, I need to generate a patch that swaps the order of TRmorrie and TR10i in the transformation pipeline. Since I cannot find the actual sympy repository in the current working directory, I'll generate the patch based on the standard sympy repository structure and the architect's analysis.

--- a/sympy/simplify/trigsimp.py
+++ b/sympy/simplify/trigsimp.py
@@ -1148,8 +1148,8 @@
                     TR2i,
                     lambda x: _eapply(factor, x, trigs),
                     TR14,  # factored powers of identities
-                    TRmorrie,
                     TR10i,  # sin-cos products > sin-cos of sums
+                    TRmorrie,
                     TR11, TR6, # reduce double angles and rewrite cos parity
                     lambda x: _eapply(factor, x, trigs),
                     TR14,  # factored powers of identities
```

---

## Step 3: QA

**Timestamp:** 2026-01-05T21:31:11.739465
**Duration:** 0.0s

### Output

```
Valid: True, Error: None
```

### Validation Checks

- diff_headers: PASS
- hunk_headers: PASS
- has_changes: PASS
- no_markdown_wrap: PASS
- path_prefixes: PASS

---

